# API Dockerfile - usa arquivos pré-buildados
FROM node:20-alpine

WORKDIR /app

# Copiar package.json da raiz e dos workspaces
COPY package.json ./
COPY package-lock.json ./

# Copiar package.json dos packages
COPY packages/core/package.json ./packages/core/
COPY packages/email-agent/package.json ./packages/email-agent/
COPY packages/legal-agent/package.json ./packages/legal-agent/
COPY packages/financial-agent/package.json ./packages/financial-agent/
COPY packages/task-agent/package.json ./packages/task-agent/
COPY packages/stablecoin-agent/package.json ./packages/stablecoin-agent/
COPY packages/focus-agent/package.json ./packages/focus-agent/
COPY apps/api/package.json ./apps/api/

# Copiar dist dos packages
COPY packages/core/dist ./packages/core/dist
COPY packages/email-agent/dist ./packages/email-agent/dist
COPY packages/legal-agent/dist ./packages/legal-agent/dist
COPY packages/financial-agent/dist ./packages/financial-agent/dist
COPY packages/task-agent/dist ./packages/task-agent/dist
COPY packages/stablecoin-agent/dist ./packages/stablecoin-agent/dist
COPY packages/focus-agent/dist ./packages/focus-agent/dist
COPY apps/api/dist ./apps/api/dist

# Instalar apenas dependências de produção
RUN npm ci --omit=dev

# Configuração
ENV NODE_ENV=production
ENV PORT=3001

EXPOSE 3001

WORKDIR /app/apps/api

CMD ["node", "dist/index.js"]

